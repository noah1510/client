name: 'Setup Headless Display Server'
description: 'Setup a headless display server for running gui programs in a headless environment'

outputs:
  HEADLESS_LAUNCHER:
    description: "The launch command to run programs in a headless environment"
    value: ${{ steps.setup_xvfb.outputs.setup_xvfb }}

runs:
  using: "composite"
  steps:
    - name: Install graphics drivers
      if: runner.os == 'Linux'
      shell: bash
      run: |
        sudo apt-get update
        sudo apt-get -y install \
            xvfb \
            x11-apps \
            x11-common \
            x11-xkb-utils \
            xinput \
            libxkbcommon-x11-0 \
            libxcursor1 \
            libgl1-mesa-dri \
            mesa-utils \
            libosmesa6 \
            mesa-vulkan-drivers \
            libvulkan1 \
            vulkan-tools \
            mesa-vulkan-drivers \
            vulkan-tools \
            vulkan-validationlayers

    - name: Setup xvfb
      id: setup_xvfb
      shell: bash
      run: echo "setup_xvfb=$GITHUB_ACTION_PATH/xvfb_launch.sh" >> "$GITHUB_OUTPUT"
        